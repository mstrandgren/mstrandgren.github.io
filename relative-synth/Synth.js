var Filter,Gain,Oscillator,Synth,Voice,audioCtx;audioCtx=new(window.AudioContext||window.webkitAudioContext),Filter=function(a,b,c){var d,e,f,g;if(e=audioCtx.createBiquadFilter(),e.type=e[a],e.Q.value=b,null!=c?c.length:void 0)for(f=0,g=c.length;g>f;f++)d=c[f],e.connect(d);else e.connect(c);return e},Gain=function(a,b){var c,d,e,f;if(d=audioCtx.createGain(),d.gain.value=a,null!=b?b.length:void 0)for(e=0,f=b.length;f>e;e++)c=b[e],d.connect(c);else d.connect(b);return d},Oscillator=function(a){var b,c,d,e,f,g,h;if(f=a.type,d=a.frequency,c=a.destination,e=audioCtx.createOscillator(),e.type=f||"square",e.frequency.value=null!=d?d:440,c.length)for(g=0,h=c.length;h>g;g++)b=c[g],e.connect(b);else e.connect(c);return e},Synth=function(){var a,b,c,d,e;return d={},e=audioCtx.createGain(),e.gain.value=.1,e.connect(audioCtx.destination),a=function(a){return null==d[a]?d[a]=Voice(a,{destination:e}):console.log("Voice already available for ",a),d[a].play()},c=function(a){var b;return null!=(b=d[a])&&b.stop(),delete d[a]},b=function(){var a,b;for(a in d)b=d[a],b.stop();return d={}},{playNote:a,stopNote:c,stopAll:b}},Voice=function(a,b){var c,d,e,f,g,h,i,j,k,l,m,n;return n=null!=b?b:{},m=n.type,c=n.destination,console.log("New voice"),f=440*Math.pow(2,(a-37)/12),d=Gain(1,c),e=Filter("LOWPASS",1,d),h=Oscillator({type:"saw",destination:e,frequency:f}),h.detune=-1200,i=Oscillator({type:"square",destination:e,frequency:f}),g=function(){return Oscillator({type:"saw",frequency:f,destination:e})},j=null,k=function(){return j=g(),j.start()},l=function(){var a,b;return a=audioCtx.currentTime,b=.2,d.gain.cancelScheduledValues(a),d.gain.setValueAtTime(d.gain.value,a),d.gain.setTargetAtTime(0,a,b),j.stop(a+10*b)},{play:k,stop:l}},window.Synth=Synth;